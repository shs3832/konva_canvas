// var canvasWidth = window.innerWidth;
// var canvasHeight = window.innerHeight;

var json =
    '{"attrs":{"width":1080,"height":1500},"className":"Stage","children":[{"attrs":{},"className":"Layer","children":[{"attrs":{"points":[0,0,10,10]},"className":"Line"},{"attrs":{"points":[0,0,0,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[10,0,10,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[20,0,20,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[30,0,30,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[40,0,40,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[50,0,50,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[60,0,60,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[70,0,70,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[80,0,80,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[90,0,90,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[100,0,100,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[110,0,110,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[120,0,120,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[130,0,130,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[140,0,140,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[150,0,150,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[160,0,160,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[170,0,170,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[180,0,180,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[190,0,190,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[200,0,200,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[210,0,210,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[220,0,220,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[230,0,230,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[240,0,240,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[250,0,250,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[260,0,260,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[270,0,270,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[280,0,280,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[290,0,290,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[300,0,300,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[310,0,310,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[320,0,320,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[330,0,330,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[340,0,340,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[350,0,350,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[360,0,360,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[370,0,370,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[380,0,380,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[390,0,390,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[400,0,400,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[410,0,410,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[420,0,420,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[430,0,430,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[440,0,440,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[450,0,450,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[460,0,460,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[470,0,470,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[480,0,480,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[490,0,490,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[500,0,500,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[510,0,510,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[520,0,520,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[530,0,530,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[540,0,540,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[550,0,550,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[560,0,560,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[570,0,570,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[580,0,580,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[590,0,590,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[600,0,600,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[610,0,610,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[620,0,620,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[630,0,630,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[640,0,640,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[650,0,650,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[660,0,660,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[670,0,670,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[680,0,680,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[690,0,690,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[700,0,700,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[710,0,710,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[720,0,720,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[730,0,730,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[740,0,740,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[750,0,750,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[760,0,760,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[770,0,770,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[780,0,780,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[790,0,790,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[800,0,800,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[810,0,810,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[820,0,820,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[830,0,830,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[840,0,840,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[850,0,850,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[860,0,860,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[870,0,870,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[880,0,880,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[890,0,890,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[900,0,900,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[910,0,910,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[920,0,920,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[930,0,930,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[940,0,940,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[950,0,950,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[960,0,960,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[970,0,970,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[980,0,980,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[990,0,990,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[1000,0,1000,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[1010,0,1010,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[1020,0,1020,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[1030,0,1030,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[1040,0,1040,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[1050,0,1050,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[1060,0,1060,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[1070,0,1070,1500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,0,1080,0],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,10,1080,10],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,20,1080,20],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,30,1080,30],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,40,1080,40],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,50,1080,50],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,60,1080,60],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,70,1080,70],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,80,1080,80],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,90,1080,90],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,100,1080,100],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,110,1080,110],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,120,1080,120],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,130,1080,130],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,140,1080,140],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,150,1080,150],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,160,1080,160],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,170,1080,170],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,180,1080,180],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,190,1080,190],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,200,1080,200],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,210,1080,210],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,220,1080,220],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,230,1080,230],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,240,1080,240],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,250,1080,250],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,260,1080,260],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,270,1080,270],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,280,1080,280],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,290,1080,290],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,300,1080,300],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,310,1080,310],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,320,1080,320],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,330,1080,330],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,340,1080,340],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,350,1080,350],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,360,1080,360],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,370,1080,370],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,380,1080,380],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,390,1080,390],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,400,1080,400],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,410,1080,410],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,420,1080,420],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,430,1080,430],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,440,1080,440],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,450,1080,450],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,460,1080,460],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,470,1080,470],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,480,1080,480],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,490,1080,490],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,500,1080,500],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,510,1080,510],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,520,1080,520],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,530,1080,530],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,540,1080,540],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,550,1080,550],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,560,1080,560],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,570,1080,570],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,580,1080,580],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,590,1080,590],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,600,1080,600],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,610,1080,610],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,620,1080,620],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,630,1080,630],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,640,1080,640],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,650,1080,650],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,660,1080,660],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,670,1080,670],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,680,1080,680],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,690,1080,690],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,700,1080,700],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,710,1080,710],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,720,1080,720],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,730,1080,730],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,740,1080,740],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,750,1080,750],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,760,1080,760],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,770,1080,770],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,780,1080,780],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,790,1080,790],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,800,1080,800],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,810,1080,810],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,820,1080,820],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,830,1080,830],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,840,1080,840],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,850,1080,850],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,860,1080,860],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,870,1080,870],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,880,1080,880],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,890,1080,890],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,900,1080,900],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,910,1080,910],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,920,1080,920],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,930,1080,930],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,940,1080,940],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,950,1080,950],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,960,1080,960],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,970,1080,970],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,980,1080,980],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,990,1080,990],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1000,1080,1000],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1010,1080,1010],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1020,1080,1020],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1030,1080,1030],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1040,1080,1040],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1050,1080,1050],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1060,1080,1060],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1070,1080,1070],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1080,1080,1080],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1090,1080,1090],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1100,1080,1100],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1110,1080,1110],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1120,1080,1120],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1130,1080,1130],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1140,1080,1140],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1150,1080,1150],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1160,1080,1160],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1170,1080,1170],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1180,1080,1180],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1190,1080,1190],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1200,1080,1200],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1210,1080,1210],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1220,1080,1220],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1230,1080,1230],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1240,1080,1240],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1250,1080,1250],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1260,1080,1260],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1270,1080,1270],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1280,1080,1280],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1290,1080,1290],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1300,1080,1300],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1310,1080,1310],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1320,1080,1320],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1330,1080,1330],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1340,1080,1340],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1350,1080,1350],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1360,1080,1360],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1370,1080,1370],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1380,1080,1380],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1390,1080,1390],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1400,1080,1400],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1410,1080,1410],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1420,1080,1420],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1430,1080,1430],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1440,1080,1440],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1450,1080,1450],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1460,1080,1460],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1470,1080,1470],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1480,1080,1480],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"},{"attrs":{"points":[0,1490,1080,1490],"stroke":"#fff","strokeWidth":0.4,"dash":[1,1]},"className":"Line"}]},{"attrs":{},"className":"Layer","children":[{"attrs":{"x":130,"y":230,"width":90,"height":10,"draggable":true,"text":"table","fill":"yellow","id":"table_0"},"className":"Image"},{"attrs":{"x":130,"y":250,"width":30,"height":30,"draggable":true,"text":"chair","fill":"black","id":"chair_0"},"className":"Image"},{"attrs":{"x":160,"y":250,"width":30,"height":30,"draggable":true,"text":"chair","fill":"black","id":"chair_1"},"className":"Image"},{"attrs":{"x":190,"y":250,"width":30,"height":30,"draggable":true,"text":"chair","fill":"black","id":"chair_2"},"className":"Image"},{"attrs":{"x":170,"y":360,"width":30,"height":30,"rotation":45,"draggable":true,"text":"chair","fill":"black","id":"chair_3","offsetX":15,"offsetY":15},"className":"Image"},{"attrs":{"x":190,"y":380,"width":30,"height":30,"rotation":45,"draggable":true,"text":"chair","fill":"black","id":"chair_4","offsetX":15,"offsetY":15},"className":"Image"},{"attrs":{"x":210,"y":400,"width":30,"height":30,"rotation":45,"draggable":true,"text":"chair","fill":"black","id":"chair_5","offsetX":15,"offsetY":15},"className":"Image"},{"attrs":{"x":200,"y":330,"width":30,"height":30,"rotation":225,"draggable":true,"text":"chair","fill":"black","id":"chair_6","offsetX":15,"offsetY":15},"className":"Image"},{"attrs":{"x":220,"y":350,"width":30,"height":30,"rotation":225,"draggable":true,"text":"chair","fill":"black","id":"chair_7","offsetX":15,"offsetY":15},"className":"Image"},{"attrs":{"x":240,"y":370,"width":30,"height":30,"rotation":225,"draggable":true,"text":"chair","fill":"black","id":"chair_8","offsetX":15,"offsetY":15},"className":"Image"}]}]}';

$ = (selector) => document.querySelector(selector);

window.addEventListener("load", () => {
    $(".spinner").style.display = "none";
});

var stage = Konva.Node.create(json, "canvas");
var ratio = document.body.getAttribute("data-ratio");
var canvasWidth = document.body.getAttribute("data-kw") / ratio;
var canvasHeight = document.body.getAttribute("data-kh") / ratio;
var canvasBg = document.body.getAttribute("data-bg");
var layer = new Konva.Layer();
var index = 0;
var chairIndex = 0;
var gridValue = 10;
var menuNode = $("#menu");
var currentShape;
var tr_options = {
    anchorStroke: "red",
    anchorFill: "yellow",
    anchorSize: 3,
    borderStroke: "green",
    borderDash: [1, 1],
};

stage.getContainer().style.backgroundImage = canvasBg;
stage.getContainer().style.backgroundSize = "100% 100%";

function addShape(rotate) {
    // var tr = new Konva.Transformer(tr_options);
    var parseRotate = parseInt(rotate);
    var rVal = parseRotate != 0 ? parseRotate : 0;
    var imageObj = new Image();
    imageObj.src = "/images/yoda.jpg";
    imageObj.onload = function () {
        var rect = new Konva.Image({
            x: stage.width() / 2,
            y: stage.height() / 2,
            width: gridValue * 9,
            height: gridValue * 1,
            rotation: rVal,
            image: imageObj,
            draggable: true,
            text: "table",
            fill: "yellow",
            id: "table_" + index,
            offset: {
                x: rVal !== 0 && rVal !== 180 ? (gridValue * 9) / 2 : 0,
                y: rVal !== 0 && rVal !== 180 ? (gridValue * 1) / 2 : 0,
            },
        });

        index++;
        layer.add(rect);
        stage.add(layer);
        layer.batchDraw();

        addEvent(rect);
    };
}

function addEvent(rect) {
    rect.on("mousedown", () => {
        layer.draw();
        $(".type").innerText = rect.attrs.text;
        $(".id").innerText = rect.attrs.id;
    });
    rect.on("dragmove", () => {
        rect.position({
            x: Math.round(rect.x() / gridValue) * gridValue,
            y: Math.round(rect.y() / gridValue) * gridValue,
        });
        stage.batchDraw();
    });
}

function addShapeChair(rotate) {
    var parseRotate = parseInt(rotate);
    var rVal = parseRotate != 0 ? parseRotate : 0;

    var imageObjChair = new Image();
    imageObjChair.src = "/images/darth-vader.jpg";
    imageObjChair.onload = function () {
        var rectChair = new Konva.Image({
            x: stage.width() / 2,
            y: stage.height() / 2,
            width: gridValue * 3,
            height: gridValue * 3,
            rotation: rVal,
            image: imageObjChair,
            draggable: true,
            text: "chair",
            fill: "black",
            id: "chair_" + chairIndex,
            offset: {
                x: rVal !== 0 && rVal !== 180 ? (gridValue * 3) / 2 : 0,
                y: rVal !== 0 && rVal !== 180 ? (gridValue * 3) / 2 : 0,
            },
        });

        chairIndex++;
        layer.add(rectChair);
        stage.add(layer);
        layer.batchDraw();
        addEventChair(rectChair);
    };
}

function addEventChair(rectChair) {
    rectChair.on("mousedown", function () {
        layer.draw();
        $(".type").innerText = this.attrs.text;
        $(".id").innerText = this.attrs.id;
    });
    rectChair.on("dragmove", (e) => {
        rectChair.position({
            x: Math.round(rectChair.x() / gridValue) * gridValue,
            y: Math.round(rectChair.y() / gridValue) * gridValue,
        });
        stage.batchDraw();
    });
}

function getJson() {
    var json = stage.toJSON();
    console.log(json);
}

$(".getJson").addEventListener("click", function () {
    getJson();
    alert("생성완료");
});

$("#delete-button").addEventListener("click", () => {
    currentShape.destroy();
    layer.draw();
    stage.batchDraw();
});

stage.on("contextmenu", function (e) {
    e.evt.preventDefault();
    if (e.target === stage) {
        return;
    }
    currentShape = e.target;
    menuNode.style.display = "initial";
    menuNode.style.top = stage.getPointerPosition().y + 4 + "px";
    menuNode.style.left = stage.getPointerPosition().x + 4 + "px";
});

window.addEventListener("click", () => {
    menuNode.style.display = "none";
});

$(".drawRect_deg").addEventListener("click", function () {
    var getDeg = $(".input_table_deg").value;
    addShape(getDeg);
});

$(".drawRectChair_deg").addEventListener("click", function () {
    var getDeg = $(".input_chair_deg").value;
    addShapeChair(getDeg);
});

var stageLayer = stage.children[1].children;
var totalStageLayer = stageLayer.length;

stageLayer.forEach((element) => {
    element.on("mousedown", () => {
        layer.draw();
        $(".type").innerText = element.attrs.text;
        $(".id").innerText = element.attrs.id;
    });
    element.on("dragmove", () => {
        element.position({
            x: Math.round(element.x() / gridValue) * gridValue,
            y: Math.round(element.y() / gridValue) * gridValue,
        });
        stage.batchDraw();
    });
});
